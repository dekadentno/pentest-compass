@startuml
actor Attacker
participant "Attacker's\nMachine" as AttackerMachine
participant "Target\nMachine" as TargetMachine
database "SMB\nService" as SMBService
database "Service\nControl Manager" as SCM

group Prerequisites
    note over Attacker, TargetMachine
        - User must be part of the Administrators local group.
        - ADMIN$ share must be available.
        - File and Printer Sharing must be turned on.
    end note
end group

Attacker -> AttackerMachine: Initiate PSExec Command
note right of AttackerMachine
    The attacker uses PSExec to execute 
    a command or deploy a payload.
end note
AttackerMachine -> SMBService: Connect via SMB
note right of SMBService
    The attacker's machine connects to the 
    target's SMB service for file transfer.
end note
AttackerMachine -> SCM: Create Service
note right of SCM
    PSExec communicates with the Service Control Manager (SCM)
    on the target to create a new service for the command execution.
end note
SCM -> TargetMachine: Execute Command/Deploy Payload
note right of TargetMachine
    The new service is started, executing the command 
    or deploying the attacker's payload.
end note
TargetMachine --> AttackerMachine: Send Results/Output
note right of AttackerMachine
    The output of the executed command or status 
    of the payload deployment is sent back to the attacker.
end note
@enduml