#!/bin/bash

: '
Usage: 
chmod 700 generate.sh
./generate.sh

Prerequisites: https://www.npmjs.com/package/node-plantuml
'

base_dir=$(dirname "$0")
dest_dir="${base_dir}/images" # where to store generated .png diagrams

mindmap_source_dir="${base_dir}/src/mindmaps"
attack_vectors_source_dir="${base_dir}/src/attack-vectors"
other_source_dir="${base_dir}/src/other-diagrams"

mkdir -p "$dest_dir"

# process .puml files in a given directory
generate_images() {
    local source_dir=$1
    for file in "${source_dir}"/*.puml; do
        if [[ -f $file ]]; then 
            base_name=$(basename "$file" .puml)
            puml generate "$file" -o "${dest_dir}/${base_name}.png"
        fi
    done
}

# call the function for each source directory
generate_images "$mindmap_source_dir"
generate_images "$attack_vectors_source_dir"
generate_images "$other_source_dir"
